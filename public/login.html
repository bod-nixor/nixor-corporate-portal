<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nixor Portal Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="/assets/app.css" />
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen flex items-center justify-center">
  <div class="bg-slate-900/80 border border-slate-800 rounded-2xl p-8 w-full max-w-md shadow-2xl">
    <div class="mb-6">
      <p class="text-xs text-indigo-300 uppercase tracking-[0.25em]">Nixor Corporate Portal</p>
      <h1 class="text-2xl font-semibold mt-2">Welcome back</h1>
      <p class="text-sm text-slate-400 mt-1">Secure access to your entity workspace.</p>
    </div>
    <form id="login-form" class="space-y-4">
      <div>
        <label for="email-input" class="text-sm text-slate-300">Email</label>
        <input id="email-input" type="email" name="email" class="mt-1 w-full rounded-xl bg-slate-950 border border-slate-800 px-4 py-3 text-sm" placeholder="you@nixor.io" required />
      </div>
      <div>
        <label for="password-input" class="text-sm text-slate-300">Password</label>
        <input id="password-input" type="password" name="password" class="mt-1 w-full rounded-xl bg-slate-950 border border-slate-800 px-4 py-3 text-sm" placeholder="Enter your password" required />
      </div>
      <div id="error-message" class="hidden text-sm text-red-400 bg-red-950/50 border border-red-800 rounded-xl px-4 py-3"></div>
      <button type="submit" class="w-full rounded-xl bg-indigo-500 hover:bg-indigo-400 transition px-4 py-3 font-medium">Sign In</button>
    </form>
    <div class="flex items-center gap-3 my-6">
      <span class="flex-1 h-px bg-slate-800"></span>
      <span class="text-xs text-slate-500">or</span>
      <span class="flex-1 h-px bg-slate-800"></span>
    </div>
    <button class="w-full rounded-xl border border-slate-700 bg-slate-900 px-4 py-3 font-medium flex items-center justify-center gap-2 opacity-60 cursor-not-allowed" disabled title="Google sign-in coming soon">
      <svg class="w-5 h-5" viewBox="0 0 48 48" aria-hidden="true"><path fill="#FFC107" d="M43.6 20.3H42V20H24v8h11.3C33.5 33.5 29.2 36 24 36c-6.6 0-12-5.4-12-12s5.4-12 12-12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C33.5 6.2 28.9 4 24 4 12.9 4 4 12.9 4 24s8.9 20 20 20 20-8.9 20-20c0-1.3-.1-2.7-.4-3.7z"/><path fill="#FF3D00" d="M6.3 14.7l6.6 4.8C14.6 16 19 12 24 12c3.1 0 5.9 1.2 8 3.1l5.7-5.7C33.5 6.2 28.9 4 24 4c-7.6 0-14.2 4.2-17.7 10.7z"/><path fill="#4CAF50" d="M24 44c4.9 0 9.4-1.9 12.8-5l-6-4.9c-2 1.4-4.5 2.2-6.8 2.2-5.1 0-9.4-3.4-10.9-8l-6.5 5C9.5 39.3 16.2 44 24 44z"/><path fill="#1976D2" d="M43.6 20.3H42V20H24v8h11.3c-1.1 3.1-3.6 5.5-7 6.8l6 4.9c-.4.4 4.7-3.4 6.7-9.7 1.4-4.1.6-9.1-.4-9.7z"/></svg>
      Sign in with Google
    </button>
    <p class="text-xs text-slate-500 mt-6">Nixor Google accounts only. Need access? Contact Admin.</p>
  </div>
  <script type="module">
    import { apiFetch } from '/assets/app.js';
    const form = document.getElementById('login-form');
    const errorEl = document.getElementById('error-message');
    const submitBtn = form.querySelector('button[type="submit"]');
    const disableForm = (message) => {
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.classList.add('opacity-60', 'cursor-not-allowed');
      }
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
    };
    apiFetch('/auth/csrf').catch(() => {
      disableForm('Unable to start login. Please refresh the page.');
    });
    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      const formData = new FormData(form);
      const payload = Object.fromEntries(formData.entries());
      if (submitBtn?.disabled) {
        return;
      }
      try {
        await apiFetch('/auth/login', { method: 'POST', body: JSON.stringify(payload) });
        errorEl.classList.add('hidden');
        window.location.href = '/dashboard.html';
      } catch (err) {
        errorEl.textContent = err.message || 'Login failed';
        errorEl.classList.remove('hidden');
      }
    });
  </script>
</body>
</html>
